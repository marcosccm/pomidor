#!/usr/bin/env ruby
require "redis"
require "main"
require_relative "./../lib/pomidor"

Main do
  fattr(:redis) { Redis.new } 
  fattr(:tracker) { Pomidor::PomodoroTracker.new } 

  def run
    help!
  end

  mode("project") do
    mode("create") do
      description("create a new project")
      argument("name") do
        description("the name of the new project")
      end
      def run 
        id = redis.llen("pomidor:projects") + 1
        redis.lpush("pomidor:projects", id)
        redis.hset("pomidor:projects:#{id}", "name", params["name"].value)
      end
    end

    mode("list") do
      def run
        puts *tracker.project_names
      end
    end
  end
end
